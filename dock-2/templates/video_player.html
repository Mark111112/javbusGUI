{% extends "base.html" %}

{% block title %}{{ movie.id }} - Video Player{% endblock %}

{% block head %}
<style>
    .video-container {
        width: 100%;
        position: relative;
        padding-bottom: 56.25%; /* 16:9 aspect ratio */
        height: 0;
        overflow: hidden;
    }
    .video-container video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #000;
    }
    .magnet-link-box {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 15px;
        border-radius: 5px;
        margin-top: 20px;
    }
    .controls-container {
        margin-top: 15px;
    }
    .no-video-message {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #000;
        color: #fff;
        height: 400px;
        border-radius: 5px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12 mb-4">
        <nav aria-label="breadcrumb" class="d-flex justify-content-between align-items-center">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item"><a href="/movie/{{ movie.id }}">Movie {{ movie.id }}</a></li>
                <li class="breadcrumb-item active">Video Player</li>
            </ol>
            <a href="/movie/{{ movie.id }}" class="btn btn-sm btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to Details
            </a>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">{{ movie.id }} - {{ movie.title }}</h5>
            </div>
            <div class="card-body">
                {% if video_url %}
                <!-- Video player with direct URL -->
                <div class="video-container">
                    <video id="videoPlayer" controls autoplay crossorigin="anonymous">
                        <source src="{{ video_url }}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
                
                <div class="controls-container">
                    <div class="btn-group" role="group">
                        <button class="btn btn-primary" onclick="document.getElementById('videoPlayer').play()">
                            <i class="bi bi-play-fill"></i> Play
                        </button>
                        <button class="btn btn-primary" onclick="document.getElementById('videoPlayer').pause()">
                            <i class="bi bi-pause-fill"></i> Pause
                        </button>
                        <button class="btn btn-primary" onclick="toggleFullScreen()">
                            <i class="bi bi-fullscreen"></i> Fullscreen
                        </button>
                    </div>
                </div>
                {% else %}
                <!-- No direct video URL available -->
                <div class="no-video-message">
                    <div class="text-center">
                        <i class="bi bi-film" style="font-size: 3rem;"></i>
                        <h4 class="mt-3">Direct streaming not available</h4>
                        <p>Please use the magnet link below to watch in an external player</p>
                    </div>
                </div>
                {% endif %}
                
                {% if magnet_link %}
                <!-- Display magnet link info -->
                <div class="magnet-link-box">
                    <h5><i class="bi bi-magnet"></i> Magnet Link (External Player)</h5>
                    <p>Open this magnet link in your favorite torrent client or media player to watch the video.</p>
                    
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="magnetInput" value="{{ magnet_link }}" readonly>
                        <button class="btn btn-outline-primary" type="button" onclick="copyMagnetLink()">
                            <i class="bi bi-clipboard"></i> Copy
                        </button>
                        <a href="{{ magnet_link }}" class="btn btn-primary">
                            <i class="bi bi-play-fill"></i> Open Link
                        </a>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-info-circle"></i> If you have VLC or another compatible media player configured, 
                        clicking "Open Link" may automatically start streaming the video.
                    </div>
                </div>
                {% else %}
                <div class="alert alert-warning mt-3">
                    <i class="bi bi-exclamation-triangle"></i> No video sources available for this movie.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function copyMagnetLink() {
        const magnetInput = document.getElementById('magnetInput');
        magnetInput.select();
        document.execCommand('copy');
        
        // Show feedback
        const button = event.currentTarget;
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="bi bi-check"></i> Copied!';
        
        setTimeout(() => {
            button.innerHTML = originalText;
        }, 2000);
    }
    
    function toggleFullScreen() {
        const video = document.getElementById('videoPlayer');
        
        if (!document.fullscreenElement) {
            if (video.requestFullscreen) {
                video.requestFullscreen();
            } else if (video.webkitRequestFullscreen) {
                video.webkitRequestFullscreen();
            } else if (video.msRequestFullscreen) {
                video.msRequestFullscreen();
            }
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }
    }
</script>
{% endblock %} 